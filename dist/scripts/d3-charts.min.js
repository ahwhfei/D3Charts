"use strict";angular.module("cwc.d3").directive("ctxBarChart",["$window","$timeout","d3",function(a,b,c){return{restrict:"A",scope:{data:"=",label:"@",onClick:"&"},link:function(d,e,f){var g,h=parseInt(f.margin)||20,i=parseInt(f.barHeight)||20,j=parseInt(f.barPadding)||5,k=c.select(e[0]).append("svg").style("width","100%");a.onresize=function(){d.$apply()},d.$watch(function(){return angular.element(a)[0].innerWidth},function(){d.render(d.data)}),d.$watch("data",function(a){d.render(a)},!0),d.render=function(a){k.selectAll("*").remove(),a&&(g&&clearTimeout(g),g=b(function(){var b=c.select(e[0])[0][0].offsetWidth-h,f=d.data.length*(i+j),g=c.scale.category20(),l=c.scale.linear().domain([0,c.max(a,function(a){return a.y})]).range([0,b]);k.attr("height",f),k.selectAll("rect").data(a).enter().append("rect").on("click",function(a){return d.onClick({item:a})}).attr("height",i).attr("width",140).attr("x",Math.round(h/2)).attr("y",function(a,b){return b*(i+j)}).attr("fill",function(a){return g(a.y)}).transition().duration(1e3).attr("width",function(a){return l(a.y)}),k.selectAll("text").data(a).enter().append("text").attr("fill","#fff").attr("y",function(a,b){return b*(i+j)+15}).attr("x",15).text(function(a){return a.name+" "+a.y})},200))}}}}]),angular.module("cwc.d3").directive("ctxPieChart",["$window","d3",function(a,b){return{restrict:"A",scope:{data:"=",label:"@",onClick:"&"},link:function(c,d){function e(a){return a.startAngle+(a.endAngle-a.startAngle)/2}if(c.data=c.data.filter(function(a){return 0!==a.y}),c.data&&!(c.data.length<1)){var f=d[0].clientHeight;0===f&&(f=300);var g=b.select(d[0]).append("svg").style("width","100%").attr({height:f}).append("g");g.append("g").attr("class","pie-slices"),g.append("g").attr("class","pie-labels"),g.append("g").attr("class","pie-lines");var h=b.layout.pie().sort(null).value(function(a){return a.y}),i=b.scale.category20(),j=b.svg.arc().innerRadius(0),k=b.svg.arc(),l=b.svg.arc();a.onresize=function(){c.$apply()},c.$watch(function(){return angular.element(a)[0].innerWidth},function(){c.render(c.data)}),c.$watch("data",function(a){c.render(a)},!0),c.render=function(a){if(g.select(".pie-slices").selectAll("*").remove(),g.select(".pie-labels").selectAll("*").remove(),g.select(".pie-lines").selectAll("*").remove(),a){var b=d[0].clientWidth,c=Math.min(b,f)/2,m=Math.round(.8*c),n=Math.round(.85*c),o=Math.round(.9*c);g.attr("transform","translate("+Math.round(b/2)+","+Math.round(Math.min(b,f)/2)+")"),j.outerRadius(m),k.outerRadius(n),l.innerRadius(m).outerRadius(o);var p=g.select(".pie-slices").selectAll("path.slice").data(h(a)),q=g.select(".pie-slices").append("path").attr("opacity",.6);p.enter().append("path").style("fill",function(a,b){return i(b)}).attr("d",j),p.on("mouseover",function(a,b){q.attr("d",k(a)).attr("fill",i(b))}).on("mouseout",function(){q.attr("d",null)}),p.exit().remove();var r=g.select(".pie-labels").selectAll("text").data(h(a));r.enter().append("text").attr("transform",function(a){var b=l.centroid(a);return b[0]=c*(e(a)<Math.PI?1:-1),"translate("+b+")"}).attr("dy","5").text(function(a){return a.data.name+": "+a.data.y}).style("text-anchor",function(a){return e(a)<Math.PI?"start":"end"}),r.exit().remove();var s=g.select(".pie-lines").selectAll("polyline").data(h(a));s.enter().append("polyline").attr("stroke",function(a,b){return i(b)}).attr("points",function(a){var b=l.centroid(a);return b[0]=.95*c*(e(a)<Math.PI?1:-1),[j.centroid(a),l.centroid(a),b]}),s.exit().remove()}}}}}}]),angular.module("cwc.d3").directive("ctxSplineChart",["$window","d3",function(a,b){return{restrict:"A",scope:{config:"=",onClick:"&"},link:function(c,d){var e=d[0].clientWidth,f=d[0].clientHeight;0===f&&(f=300);var g={left:60,top:30,right:60,bottom:30},h=function(a){for(var b=Math.max.apply(null,a[0].data),c=1;c<a.length;c++){var d=Math.max.apply(null,a[c].data);b=Math.max(b,d)}return b},i=b.select(d[0]).append("svg").style("width","100%").attr({height:f}),j=i.append("g").attr("transform","translate("+g.left+", "+g.top+")"),k=b.select("body").append("div").attr("class","tooltip").style("opacity",0),l=b.scale.category20(),m=e-g.left-g.right,n=f-g.top-g.bottom,o=b.scale.ordinal(),p=b.scale.linear().range([n,0]),q=b.svg.line().x(function(a,b){return o(c.config.xAxis.categories[b])}).y(function(a){return p(a)}),r=b.svg.axis().scale(o).orient("bottom"),s=b.svg.axis().scale(p).orient("left"),t=j.append("g").attr("class","x spline-axis").attr("transform","translate(0, "+n+")"),u=j.append("g").attr("class","y spline-axis"),v=j.append("g").attr("class","spline-lines");a.onresize=function(){c.$apply()},c.$watch(function(){return angular.element(a)[0].innerWidth},function(){c.render(c.config.series)}),c.$watch("config.series",function(a){c.render(a)},!0),c.render=function(a){if(i.select(".spline-lines").selectAll("*").remove(),a){e=d[0].clientWidth,m=e-g.left-g.right,i.attr("width",e),o.domain(c.config.xAxis.categories.map(function(a){return a})).rangePoints([0,m]),p.domain([0,h(c.config.series)]);var f=c.config.xAxis.categories.length,j=Math.ceil(100*(f-1)/m);r.tickValues(c.config.xAxis.categories.filter(function(a,b){return b%j===0})),t.call(r),u.call(s);for(var n=0;n<c.config.series.length;n++){var w=c.config.series[n].data,x=v.append("g").attr("class","spline-line");x.append("path").attr("stroke",l(n)).attr("d",q(w)),x.selectAll("dot").data(w).enter().append("circle").attr("class","dot").attr("fill",l(n)).attr("r",5).attr("cx",function(a,b){return o(c.config.xAxis.categories[b])}).attr("cy",function(a){return p(a)}).on("mouseover",function(a,d){b.select(this).transition().duration(200).attr("r",7),k.transition().duration(200).style("opacity",.8),k.html(c.config.xAxis.categories[d]+"<br/>"+a).style("left",b.event.pageX-50+"px").style("top",b.event.pageY-38+"px")}).on("mouseout",function(){b.select(this).transition().duration(500).attr("r",5),k.transition().duration(500).style("opacity",0)})}}}}}}]),angular.module("cwc.d3",[]),angular.module("cwc.d3.templates",[]),angular.module("cwc.d3.templates",[]);